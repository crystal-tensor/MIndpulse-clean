"use strict";(()=>{var e={};e.id=688,e.ids=[688],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1568:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>b,staticGenerationAsyncStorage:()=>d});var i={};r.r(i),r.d(i,{POST:()=>h});var a=r(9303),l=r(8716),s=r(670),n=r(7070);async function o(e,t,r){let i=r?.apiKey||process.env.DEEPSEEK_API_KEY;r?.provider;let a=r?.model||"deepseek-chat",l=r?.baseUrl||"https://api.deepseek.com/v1";if(!i)return{title:"量子洞察",content:"\uD83C\uDF1F 在命运的织机上，每一个选择都是一根丝线，编织着未来的图案。",risks:"⚠️ 山重水复疑无路，柳暗花明又一村。",probability:`成功概率：${Math.round(100*t.probability)}%`};let s=e.filter(e=>"目标"===e.type).map(e=>e.name),n=e.filter(e=>"资源"===e.type).map(e=>e.name),o=e.filter(e=>"约束"===e.type).map(e=>e.name),c=`
作为一位专业的决策分析师，请基于以下量子计算结果，为用户提供极具专业而富有洞察力的建议：

**用户情况分析：**
- 目标：${s.join(", ")}
- 可用资源：${n.join(", ")}
- 约束条件：${o.join(", ")}

**量子计算结果：**
- 成功概率：${Math.round(100*t.probability)}%
- 风险系数：${t.metrics["风险系数"]}%
- 可行性：${t.metrics["可行性"]}%
- 综合得分：${t.metrics["综合得分"]}%

请从以下角度分析：
1. 资源与约束的各种组合与目标的差距、关联性和可能性
2. 在当前资源配置下达到目标的突破方向和解决方案
3. 基于成功概率${Math.round(100*t.probability)}%的最有效途径分析
4. 如果成功概率较高(>70%)给予肯定，如果较低(<50%)鼓励探索最切实际的解决方案

请用JSON格式返回：
{
  "title": "专业分析标题",
  "content": "深度分析内容（专业洞察，突破方向，解决方案，最有效途径）",
  "risks": "风险提示（保持专业而不失幽默的风格）",
  "probability": "基于成功概率${Math.round(100*t.probability)}%的专业解读（从资源约束组合与目标差距角度分析）"
}
`;try{let e=await fetch(`${l}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({model:a,messages:[{role:"user",content:c}],temperature:.8,response_format:{type:"json_object"}})});if(e.ok){let r=(await e.json()).choices[0].message.content;try{let e=JSON.parse(r);return{title:String(e.title||"量子洞察分析"),content:"object"==typeof e.content?Object.entries(e.content).map(([e,t])=>`**${e}**: ${t}`).join("\n\n"):String(e.content||"基于量子计算结果的专业分析"),risks:String(e.risks||"请注意相关风险因素"),probability:String(e.probability||`成功概率：${Math.round(100*t.probability)}%`)}}catch(e){return console.error("JSON解析失败:",e),{title:"量子洞察分析",content:String(r),risks:"请仔细评估相关风险",probability:`成功概率：${Math.round(100*t.probability)}%`}}}}catch(e){console.error("LLM调用失败:",e)}return{title:"量子洞察",content:"\uD83C\uDF1F 在命运的织机上，每一个选择都是一根丝线，编织着未来的图案。",risks:"⚠️ 山重水复疑无路，柳暗花明又一村。",probability:`成功概率：${Math.round(100*t.probability)}%`}}class c{constructor(e,t=.5){this.variables=e,this.riskPreference=t}generateParetoFrontChart(e){let t=0,r=-1/0;return e.forEach((e,i)=>{let a=e.reward-e.risk+e.feasibility;a>r&&(r=a,t=i)}),{data:e.map((e,r)=>({x:e.risk,y:e.reward,z:e.feasibility,name:`策略 ${r+1}`,color:e.reward-e.risk,isOptimal:r===t})),layout:{title:"三维帕累托前沿分布（风险-回报-策略）",xaxis:"风险指数",yaxis:"回报指数",zaxis:"策略可行性"}}}modelAsQUBO(){let e=this.variables.length,t=Array(e).fill(0).map(()=>Array(e).fill(0));for(let r=0;r<e;r++){let e=this.variables[r];"目标"===e.type?t[r][r]+=e.weight*e.confidence:"资源"===e.type&&(t[r][r]+=.8*e.weight*e.confidence)}for(let r=0;r<e;r++){let i=this.variables[r];if("约束"===i.type){let a=i.weight*(1-i.confidence)*2;t[r][r]+=a;for(let i=0;i<e;i++)r!==i&&"目标"===this.variables[i].type&&(t[r][i]+=.5*a,t[i][r]+=.5*a)}}for(let r=0;r<e;r++)for(let i=r+1;i<e;i++){let e=this.variables[r],a=this.variables[i];if("目标"===e.type&&"资源"===a.type){let e=.3*this.riskPreference;t[r][i]+=e,t[i][r]+=e}else if("资源"===e.type&&"资源"===a.type){let e=.2*(1-this.riskPreference);t[r][i]+=e,t[i][r]+=e}}return t}solveVQE(e){let t=e.length,r=1/0,i=Array(t).fill(0);for(let a=0;a<100;a++){let l=Array(t).fill(0).map(()=>2*Math.random()-1),s=0;for(let r=0;r<t;r++)for(let i=0;i<t;i++)s+=e[r][i]*l[r]*l[i];if((s+=(Math.random()-.5)*.1)<r&&(r=s,i=[...l]),a%10==0){let e=1-a/100;for(let r=0;r<t;r++)i[r]+=(Math.random()-.5)*e*.1}}let a=Math.sqrt(i.reduce((e,t)=>e+t*t,0));return{eigenvalue:r,eigenvector:i=i.map(e=>e/a),iterations:100}}calculateParetoFront(e){let t=[];for(let r=0;r<e.length;r++){let i=!1;for(let t=0;t<e.length;t++)if(r!==t&&e[t].risk<=e[r].risk&&e[t].reward>=e[r].reward&&e[t].feasibility>=e[r].feasibility&&(e[t].risk<e[r].risk||e[t].reward>e[r].reward||e[t].feasibility>e[r].feasibility)){i=!0;break}i||t.push({risk:e[r].risk,reward:e[r].reward,feasibility:e[r].feasibility})}return t}async solve(e){let t=this.modelAsQUBO(),r=this.solveVQE(t),i=[];for(let e=0;e<50;e++){let e=r.eigenvector.map(e=>e+(Math.random()-.5)*.2),t=this.calculateRisk(e),a=this.calculateReward(e),l=this.calculateFeasibility(e);i.push({vector:e,risk:t,reward:a,feasibility:l})}let a=this.calculateParetoFront(i),l=this.generateParetoFrontChart(a),s=i.sort((e,t)=>t.reward-t.risk*this.riskPreference-(e.reward-e.risk*this.riskPreference)).slice(0,3),n=[];for(let t=0;t<s.length;t++){let i=s[t],c={id:`solution_${t+1}`,probability:this.calculateProbability(i.vector),strategy:this.generateStrategy(i.vector,t),metrics:{成功概率:Math.round(100*i.reward),风险系数:Math.round(100*i.risk),可行性:Math.round(100*i.feasibility),综合得分:Math.round((i.reward-i.risk*this.riskPreference)*100)},actions:this.generateActions(i.vector,t),quantumMetrics:{eigenvalue:r.eigenvalue,convergenceIterations:r.iterations,quantumVolume:1024*this.variables.length,paretoFront:a,paretoFrontChart:l}};try{let t=await o(this.variables,c,e);n.push({...c,aiInsight:t})}catch(e){console.error("生成AI洞察失败:",e),n.push(c)}}return n}calculateRisk(e){let t=0;for(let r=0;r<this.variables.length;r++){let i=this.variables[r];"约束"===i.type&&(t+=Math.abs(e[r])*i.weight*(1-i.confidence))}return Math.min(1,t/this.variables.length)}calculateReward(e){let t=0;for(let r=0;r<this.variables.length;r++){let i=this.variables[r];"目标"===i.type&&(t+=Math.abs(e[r])*i.weight*i.confidence)}return Math.min(1,t/this.variables.filter(e=>"目标"===e.type).length)}calculateFeasibility(e){let t=0;for(let r=0;r<this.variables.length;r++){let i=this.variables[r];"资源"===i.type&&(t+=Math.abs(e[r])*i.weight*i.confidence)}return Math.min(1,t/this.variables.filter(e=>"资源"===e.type).length)}calculateProbability(e){return Math.min(1,Math.max(0,e.reduce((e,t)=>e+t*t,0)/e.length))}generateStrategy(e,t){let r=this.variables.filter(e=>"目标"===e.type),i=this.variables.filter(e=>"资源"===e.type),a=this.variables.filter(e=>"约束"===e.type),l=["专注核心目标，优化资源配置，审慎管理风险","平衡发展策略，兼顾多个目标，稳健推进","创新突破方案，承担适度风险，寻求最大回报"][t]||"专注核心目标，优化资源配置，审慎管理风险";if(r.length>0){let e=r[0];l=`${l}。重点关注${e.name}，`}if(i.length>0){let e=i[0];l+=`充分利用${e.name}，`}if(a.length>0){let e=a[0];l+=`同时注意${e.name}的限制。`}return l}generateActions(e,t){let r=this.variables.filter(e=>"目标"===e.type),i=this.variables.filter(e=>"资源"===e.type),a=this.variables.filter(e=>"约束"===e.type);return{immediate:[`制定${r[0]?.name||"核心目标"}的具体实施计划`,`评估和调配${i[0]?.name||"关键资源"}`,`建立${a[0]?.name||"约束条件"}的监控机制`],monitor:["跟踪关键指标的变化趋势","定期评估策略执行效果","监控外部环境变化"],fallback:["如果进展不及预期，考虑调整策略权重","准备替代方案以应对突发情况","建立风险预警和应急响应机制"]}}}async function h(e){try{let{variables:t,sessionId:r,problemTitle:i,systemSettings:a,llmSettings:l}=await e.json();if(!t||0===t.length)return n.NextResponse.json({error:"缺少决策变量"},{status:400});let s=new c(t,a?.riskPreference||.5),o=await s.solve(l);return console.log(`量子计算完成 - 会话ID: ${r}, 问题: ${i}`),console.log(`生成了 ${o.length} 个解决方案`),n.NextResponse.json({success:!0,solutions:o,metadata:{sessionId:r,problemTitle:i,computedAt:new Date().toISOString(),algorithm:"VQE + Pareto Optimization",quantumBackend:a?.quantumBackend||"IBM Quantum Simulator"}})}catch(e){return console.error("量子计算错误:",e),n.NextResponse.json({error:"量子计算失败",details:e instanceof Error?e.message:"未知错误"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/mindpilot/quantum-solve/route",pathname:"/api/mindpilot/quantum-solve",filename:"route",bundlePath:"app/api/mindpilot/quantum-solve/route"},resolvedPagePath:"/Users/danielcrystal/work/MindPulse-Clean/app/api/mindpilot/quantum-solve/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:b}=u,m="/api/mindpilot/quantum-solve/route";function f(){return(0,s.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:d})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[276,972],()=>r(1568));module.exports=i})();