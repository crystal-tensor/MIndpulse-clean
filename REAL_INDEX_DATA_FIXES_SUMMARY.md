# çœŸå®æŒ‡æ•°æ•°æ®ä¿®å¤æ€»ç»“

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘ŠæŠ•èµ„ç»„åˆä¸å¸‚åœºæŒ‡æ•°å¯¹æ¯”å›¾ä¸­çš„æŒ‡æ•°èµ°åŠ¿ä¸å¯¹ï¼Œæ— è®ºé€‰æ‹©å“ªä¸ªæŒ‡æ•°ï¼Œæ˜¾ç¤ºçš„éƒ½æ˜¯æ¨¡æ‹Ÿæ•°æ®è€Œä¸æ˜¯çœŸå®çš„æŒ‡æ•°å†å²æ•°æ®ã€‚éœ€è¦ï¼š

1. ä»è‚¡ç¥¨å­—å…¸ä¸­è·å–çœŸå®çš„æŒ‡æ•°ä»£ç 
2. æ ¹æ®ä»£ç è·å–çœŸå®çš„æŒ‡æ•°å†å²æ•°æ®
3. å¯¹æ¯”æ—¶è¿›è¡Œç»Ÿä¸€çš„å½’ä¸€åŒ–å¤„ç†

## ä¿®å¤æ–¹æ¡ˆ

### 1. åˆ›å»ºæŒ‡æ•°æ•°æ®è·å–Pythonè„šæœ¬

**æ–‡ä»¶**: `python-api/get_index_data.py`

**åŠŸèƒ½**:
- ä½¿ç”¨baostockæ•°æ®æºè·å–çœŸå®æŒ‡æ•°å†å²æ•°æ®
- æ”¯æŒå¤šä¸ªæŒ‡æ•°åŒæ—¶è·å–
- è‡ªåŠ¨è®¡ç®—å½’ä¸€åŒ–æ”¶ç›Šç‡ï¼ˆä»¥ç¬¬ä¸€ä¸ªäº¤æ˜“æ—¥ä¸ºåŸºå‡†ï¼‰
- è¾“å‡ºæ ‡å‡†JSONæ ¼å¼æ•°æ®

**å…³é”®ç‰¹æ€§**:
```python
def get_index_data(index_codes, start_date=None, end_date=None):
    # è·å–ä¸€å¹´çš„å†å²æ•°æ®
    # è®¡ç®—å½’ä¸€åŒ–æ”¶ç›Šç‡: (price/base_price - 1) * 100
    # è¿”å›åŒ…å«æ—¥æœŸã€ä»·æ ¼ã€æ”¶ç›Šç‡çš„å®Œæ•´æ•°æ®
```

### 2. åˆ›å»ºæŒ‡æ•°æ•°æ®APIç«¯ç‚¹

**æ–‡ä»¶**: `app/api/mindpilot/index-data/route.ts`

**åŠŸèƒ½**:
- æ¥æ”¶æŒ‡æ•°ä»£ç åˆ—è¡¨
- è°ƒç”¨Pythonè„šæœ¬è·å–çœŸå®æ•°æ®
- å¤„ç†baostockç™»å½•/ç™»å‡ºä¿¡æ¯è¾“å‡º
- è¿”å›æ ‡å‡†åŒ–çš„JSONå“åº”

**å…³é”®ä¿®å¤**:
```typescript
// è¿‡æ»¤æ‰baostockçš„ç™»å½•/ç™»å‡ºä¿¡æ¯ï¼Œåªè§£æJSONæ•°æ®
for (let i = lines.length - 1; i >= 0; i--) {
  const line = lines[i].trim();
  if (line.startsWith('{') && line.includes('success')) {
    jsonLine = line;
    break;
  }
}
```

### 3. ä¿®æ”¹æŠ¥å‘Šç”Ÿæˆé€»è¾‘

**æ–‡ä»¶**: `app/api/mindpilot/generate-report/route.ts`

**ä¿®æ”¹å†…å®¹**:

1. **æ–°å¢çœŸå®æŒ‡æ•°æ•°æ®è·å–å‡½æ•°**:
```typescript
async function generateIndexComparison(request: NextRequest) {
  // è·å–çœŸå®æŒ‡æ•°æ•°æ®
  const indexData = await getIndexData(indexCodes);
  // è¿›è¡Œå½’ä¸€åŒ–å¤„ç†
  // è¿”å›æ ‡å‡†åŒ–çš„æŒ‡æ•°å¯¹æ¯”æ•°æ®
}
```

2. **ä¿ç•™æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºå›é€€**:
```typescript
function generateSimulatedIndexComparison() {
  // å½“æ— æ³•è·å–çœŸå®æ•°æ®æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
}
```

3. **ä¿®æ”¹å›¾è¡¨æ•°æ®ç”Ÿæˆ**:
```typescript
async function generateChartData(..., request?: NextRequest) {
  const indexComparison = request ? 
    await generateIndexComparison(request) : 
    generateSimulatedIndexComparison();
}
```

### 4. æŒ‡æ•°åç§°å’Œä»£ç æ˜ å°„

**ä¿®å¤çš„æŒ‡æ•°æ˜ å°„**:
```typescript
const indices = [
  { name: 'ä¸Šè¯ç»¼åˆæŒ‡æ•°', symbol: 'sh.000001', color: '#FF6B6B' },
  { name: 'æ·±è¯æˆæŒ‡', symbol: 'sz.399001', color: '#4ECDC4' },
  { name: 'æ²ªæ·±300æŒ‡æ•°', symbol: 'sz.399300', color: '#45B7D1' },
  { name: 'ä¸­è¯500æŒ‡æ•°', symbol: 'sz.399905', color: '#96CEB4' },
  { name: 'åˆ›ä¸šæ¿æŒ‡æ•°(ä»·æ ¼)', symbol: 'sz.399006', color: '#FFEAA7' }
];
```

### 5. å½’ä¸€åŒ–å¤„ç†

**ç»Ÿä¸€å½’ä¸€åŒ–ç®—æ³•**:
```python
# ä»¥ç¬¬ä¸€ä¸ªäº¤æ˜“æ—¥ä¸ºåŸºå‡†ï¼Œè®¡ç®—ç›¸å¯¹æ”¶ç›Šç‡
base_price = df['close'].iloc[0]
normalized_returns = ((df['close'] / base_price - 1) * 100).tolist()
```

è¿™ç¡®ä¿äº†ï¼š
- æ‰€æœ‰æŒ‡æ•°éƒ½ä»0%å¼€å§‹
- æŠ•èµ„ç»„åˆå’ŒæŒ‡æ•°å¯ä»¥åœ¨åŒä¸€åæ ‡ç³»ä¸‹å¯¹æ¯”
- æ”¶ç›Šç‡ä»¥ç™¾åˆ†æ¯”å½¢å¼æ˜¾ç¤º

## æµ‹è¯•éªŒè¯

**æµ‹è¯•æ–‡ä»¶**: `test-real-index-data.js`

**æµ‹è¯•ç»“æœ**:
```
âœ… æŒ‡æ•°æ•°æ®APIå“åº”æˆåŠŸ
ğŸ“ˆ è·å–5ä¸ªæŒ‡æ•°çš„çœŸå®æ•°æ®ï¼Œå„242ä¸ªæ•°æ®ç‚¹
ğŸ“Š æ—¥æœŸèŒƒå›´: 2024-06-28 åˆ° 2025-06-27
ğŸ¯ æ‰€æœ‰æŒ‡æ•°éƒ½æœ‰æ­£ç¡®çš„å½’ä¸€åŒ–æ”¶ç›Šç‡
```

**æµ‹è¯•çš„æŒ‡æ•°**:
- ä¸Šè¯ç»¼åˆæŒ‡æ•° (sh.000001): 15.39%æ”¶ç›Šç‡
- æ·±è¯æˆæŒ‡ (sz.399001): 17.29%æ”¶ç›Šç‡  
- æ²ªæ·±300æŒ‡æ•° (sz.399300): 13.29%æ”¶ç›Šç‡
- ä¸­è¯500æŒ‡æ•° (sz.399905): 18.63%æ”¶ç›Šç‡
- åˆ›ä¸šæ¿æŒ‡æ•° (sz.399006): 26.19%æ”¶ç›Šç‡

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- æŒ‡æ•°å¯¹æ¯”å›¾æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®
- æŒ‡æ•°èµ°åŠ¿ä¸å®é™…å¸‚åœºä¸ç¬¦
- æ— æ³•è¿›è¡ŒçœŸå®çš„ä¸šç»©å¯¹æ¯”

### ä¿®å¤å
- âœ… è·å–çœŸå®çš„æŒ‡æ•°å†å²æ•°æ®
- âœ… æ­£ç¡®çš„å½’ä¸€åŒ–å¤„ç†
- âœ… æŠ•èµ„ç»„åˆä¸å¸‚åœºæŒ‡æ•°å¯ä»¥å‡†ç¡®å¯¹æ¯”
- âœ… æ•°æ®æ¥æºæ ‡è®°ä¸º'real'
- âœ… æ”¯æŒå¤šä¸ªä¸»è¦å¸‚åœºæŒ‡æ•°

## æŠ€æœ¯è¦ç‚¹

1. **æ•°æ®æº**: ä½¿ç”¨baostockè·å–çœŸå®å¸‚åœºæ•°æ®
2. **å½’ä¸€åŒ–**: ç»Ÿä¸€ä»¥ç¬¬ä¸€ä¸ªäº¤æ˜“æ—¥ä¸ºåŸºå‡†è®¡ç®—æ”¶ç›Šç‡
3. **å®¹é”™**: ä¿ç•™æ¨¡æ‹Ÿæ•°æ®ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
4. **æ€§èƒ½**: æ”¯æŒæ‰¹é‡è·å–å¤šä¸ªæŒ‡æ•°æ•°æ®
5. **æ ‡å‡†åŒ–**: JSONæ ¼å¼è¾“å‡ºï¼Œä¾¿äºå‰ç«¯å¤„ç†

## æ–‡ä»¶å˜æ›´åˆ—è¡¨

- âœ… `python-api/get_index_data.py` - æ–°å¢
- âœ… `app/api/mindpilot/index-data/route.ts` - æ–°å¢  
- âœ… `app/api/mindpilot/generate-report/route.ts` - ä¿®æ”¹
- âœ… `python-api/baostock_data.py` - ä¿®æ”¹ï¼ˆç§»é™¤è°ƒè¯•è¾“å‡ºï¼‰
- âœ… `test-real-index-data.js` - æ–°å¢æµ‹è¯•æ–‡ä»¶

## ä½¿ç”¨è¯´æ˜

ç”¨æˆ·ç°åœ¨å¯ä»¥åœ¨èµ„äº§é…ç½®æŠ¥å‘Šä¸­é€‰æ‹©ä»»æ„æŒ‡æ•°è¿›è¡Œå¯¹æ¯”ï¼Œç³»ç»Ÿå°†ï¼š

1. è‡ªåŠ¨è·å–è¯¥æŒ‡æ•°çš„çœŸå®å†å²æ•°æ®
2. è¿›è¡Œå½’ä¸€åŒ–å¤„ç†
3. ä¸æŠ•èµ„ç»„åˆè¡¨ç°è¿›è¡Œå‡†ç¡®å¯¹æ¯”
4. æ˜¾ç¤ºçœŸå®çš„å¸‚åœºèµ°åŠ¿

è¿™ä¸ºæŠ•èµ„å†³ç­–æä¾›äº†æ›´å‡†ç¡®çš„å‚è€ƒä¾æ®ã€‚ 